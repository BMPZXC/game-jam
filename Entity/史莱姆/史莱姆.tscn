[gd_scene load_steps=4 format=3 uid="uid://ks74cfuka2mp"]

[ext_resource type="Texture2D" uid="uid://dhuyg6rqovntn" path="res://Asset/史莱姆-Sheet.png" id="1_pcsgp"]

[sub_resource type="GDScript" id="GDScript_pcsgp"]
script/source = "extends  CharacterBody2D
@export var 敌人:CharacterBody2D

var 禁用_下落:bool=false
var 模式:Callable=靠近
func _physics_process(delta: float) -> void:
	if 敌人:
		模式.call(delta)
	if not 禁用_下落:
		if not is_on_floor():
			velocity.y+=delta*300
		else :
			velocity.y=0
		
	move_and_slide()

func 靠近(delta: float):
	var 方向=sign(敌人.global_position.x-global_position.x)
	velocity.x=velocity.x +(10*方向-velocity.x)*10*delta
	
	下砸_冷却-=delta
	if 下砸_冷却<=0:
		下砸()
	
@onready var collision_shape_2d: CollisionShape2D = $CollisionShape2D
func 空(_delta):
	pass
var 下砸_冷却=1
func 下砸():
	模式=空
	禁用_下落=true
	collision_shape_2d.disabled=true
	var a= get_tree().create_tween()
	a.tween_property(self,\"position\",position+Vector2(0,-200),0.2)
	a.finished.connect(func ():下砸_1())
func 下砸_1():
	模式=下砸_锁定
	await get_tree().create_timer(0.4).timeout
	
	模式=下砸_攻击
func 下砸_锁定(_delta: float):
	global_position.x=敌人.global_position.x
func 下砸_攻击(_delta: float):
	if not is_on_floor():
		velocity.y=500
	if collision_shape_2d.disabled:
		if abs(敌人.position.y-global_position.y)>100:return
		collision_shape_2d.disabled=false
		禁用_下落=false
		下砸_冷却=6
		模式=靠近
	
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ud7mm"]
size = Vector2(68, 56)

[node name="CharacterBody2D" type="CharacterBody2D"]
scale = Vector2(0.5, 0.5)
collision_layer = 4
script = SubResource("GDScript_pcsgp")

[node name="史莱姆-sheet" type="Sprite2D" parent="."]
texture = ExtResource("1_pcsgp")
hframes = 5

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -4)
shape = SubResource("RectangleShape2D_ud7mm")
